# Настройка API ключей для AI чата

## Проблема: "API ключ не настроен"

Если вы видите ошибку **"API ключ не настроен: proxyapi.api_key"** или подобную, это значит, что вам нужно добавить API ключи в админ-панели.

## Шаг 1: Выберите провайдера AI

### Вариант 1: OpenRouter (рекомендуется - есть бесплатные модели)

1. Зарегистрируйтесь на [https://openrouter.ai](https://openrouter.ai)
2. Получите API ключ в разделе "Keys"
3. В админ-панели вашего бота:
   - Перейдите в раздел **"API Ключи"**
   - Добавьте ключ:
     - **Провайдер**: `openrouter`
     - **Название ключа**: `api_key`
     - **Значение**: ваш API ключ OpenRouter

**Бесплатные модели OpenRouter** (автоматически обновляются):
- `deepseek-r1` - мощная модель DeepSeek
- `llama-3.3-70b` - Meta Llama 3.3 70B
- `qwen-2.5-72b` - Qwen 2.5 72B
- `gemma-2-27b` - Google Gemma 2 27B

### Вариант 2: Yandex GPT

1. Создайте сервисный аккаунт в Yandex Cloud
2. Получите API ключ и Folder ID
3. В админ-панели добавьте 2 ключа:
   - **Провайдер**: `yandex`
   - **Ключ 1**: `api_key` = ваш API ключ
   - **Ключ 2**: `folder_id` = ваш Folder ID

### Вариант 3: ProxyAPI (платные модели OpenAI/Claude)

1. Зарегистрируйтесь на ProxyAPI
2. Получите API ключ
3. В админ-панели добавьте:
   - **Провайдер**: `proxyapi`
   - **Название ключа**: `api_key`
   - **Значение**: ваш API ключ ProxyAPI

## Шаг 2: Выберите модель в настройках AI

После добавления ключей:

1. Перейдите в **"Настройки AI"**
2. Выберите модель в зависимости от провайдера:
   - **OpenRouter**: `deepseek-r1`, `llama-3.3-70b`, `qwen-2.5-72b`, `gemma-2-27b`
   - **Yandex**: `yandexgpt` или `yandexgpt-lite`
   - **ProxyAPI**: `gpt-4o-mini`, `o1-mini`, `claude-3-haiku`

## Автоматическое обновление моделей OpenRouter

Система автоматически:
- Проверяет доступность бесплатных моделей каждый час
- Использует актуальные рабочие модели
- Если модель недоступна, автоматически выбирает альтернативу

**Приоритет выбора бесплатных моделей:**
1. DeepSeek (самые мощные)
2. Llama 3.3/3.2 (стабильные)
3. Qwen 2.5 (альтернатива)
4. Gemma 2 (Google модели)
5. Mistral/Phi (fallback)

## Проверка работы

После настройки API ключей:
1. Откройте ваш чат-бот
2. Отправьте тестовое сообщение
3. Если всё настроено правильно — получите ответ от AI

## Частые ошибки

### "API ключ не настроен: proxyapi.api_key"
- **Причина**: Вы выбрали модель OpenAI/Claude, но не добавили ключ ProxyAPI
- **Решение**: Либо добавьте ключ ProxyAPI, либо выберите бесплатную модель OpenRouter

### "Модель недоступна"
- **Причина**: Выбранная бесплатная модель больше не доступна на OpenRouter
- **Решение**: Система автоматически выберет альтернативу. Если проблема сохраняется — обновите выбор модели в настройках

### "No endpoints found for google/gemma-2-9b-it:free"
- **Причина**: Модель Gemma 2 9B была заменена на 27B версию
- **Решение**: Система автоматически использует `google/gemma-2-27b-it:free`
